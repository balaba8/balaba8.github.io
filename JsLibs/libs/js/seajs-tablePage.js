/*! 作者:阿伟 */
/*! git:https://github.com/aweiu/JsLibs.git */
/*! 推荐sealoader模块加载器:https://www.npmjs.com/package/sealoader */
/*! 最后修改于 2016-04-18 11:35:42 */
define(function(require,exports,module){var httpClient=require("seajs-httpClient"),tip=require("seajs-gritter"),table,config,row,tableColumn,tbody,setTBodyInnerHTML=function(a,b){try{a.innerHTML=b}catch(c){for(var d=a.childNodes,e=d.length,f=e-1;f>=0;f--)a.removeChild(d[f]);if(""==b.replace(/ /g,""))return;var g=document.createElement("div");g.innerHTML="<table>"+b+"</table>";var h=g.getElementsByTagName("tbody")[0].childNodes;for(e=h.length,f=e-1;f>=0;f--)a.insertBefore(h[f],a.firstChild)}},drawTable=function(data,page){setTBodyInnerHTML(tbody,"");try{var dataJson=config.dataKey?eval("data."+config.dataKey):data}catch(e){console.log(e)}finally{if(null==dataJson||0==dataJson.length)return null!=row&&(table.parentNode.removeChild(row),row=null),void tip.show("暂无数据",!1)}for(var i=0;i<dataJson.length;i++){for(var tr=document.createElement("tr"),k=0;tableColumn>k;k++){var td=document.createElement("td"),valueTmp=config.data[k];if("function"==typeof valueTmp)var vResult=valueTmp(dataJson[i],{baseJson:data,rows:i,columns:k});else vResult="$"==valueTmp.substring(0,1)?valueTmp.substring(1,valueTmp.length)/1+i:valueTmp.replace(/\{(.*?)\}/g,function($0,$1){var evalue=eval("dataJson[i]."+$1);return null!=evalue?evalue:"-"});"object"!=typeof vResult?td.innerHTML=vResult:td.appendChild(vResult),tr.appendChild(td)}tbody.appendChild(tr)}var pageTotal=eval("data."+config.pageTotalKey);createPagination(pageTotal,page);var onfinish=config.onfinish||exports.onfinish;onfinish&&onfinish(data)},createPagination=function(a,b){if(null!=row&&(table.parentNode.removeChild(row),row=null),!(null==a||2>a)){row=document.createElement("div"),row.className="row";var c=document.createElement("div");c.className="col-sm-5";var d=document.createElement("div");d.className="dataTables_info",d.innerHTML="第 ";var e=document.createElement("span");e.innerHTML=b;var f=document.createElement("span");f.innerHTML=" 页 ( 总共 "+a+" 页 )",d.appendChild(e),d.appendChild(f),c.appendChild(d),row.appendChild(c);var g=document.createElement("div");g.className="col-sm-7";var h=document.createElement("div");h.className="dataTables_paginate paging_simple_numbers",g.appendChild(h),row.appendChild(g);var i=document.createElement("ul");i.className="pagination",h.appendChild(i);for(var j=0;a+1>=j;j++){var k=document.createElement("li");if(k.style.cursor="pointer",k.onclick=function(){"disabled"!=this.className&&(-1!=this.innerHTML.indexOf("上一页")?exports.run(--b):-1!=this.innerHTML.indexOf("下一页")?exports.run(++b):exports.run(this.childNodes[0].innerHTML))},i.appendChild(k),0==j)k.innerHTML="<a>上一页</a>",1==b&&(k.className="disabled");else{if(j==a+1||8==j){k.innerHTML="<a>下一页</a>",b==a&&(k.className="disabled");break}k.innerHTML="<a>"+j+"</a>"}}if(a>7){var l=i.childNodes[2],m=i.childNodes[6],n=function(a){a.childNodes[0].innerHTML="…",a.className="disabled"};if(i.childNodes[7].innerHTML="<a>"+a+"</a>",5>b)n(m),i.childNodes[b].className="active";else if(b>a-4){n(l);for(var j=a-4;a>=j;j++){var o=i.childNodes[7-a+j];j==b&&(o.className="active"),o.innerHTML="<a>"+j+"</a>"}}else{n(l),n(m),i.childNodes[4].className="active";for(var j=b-1;b/1+1>=j;j++)i.childNodes[4-b+j].innerHTML="<a>"+j+"</a>"}}else i.childNodes[b].className="active";table.parentNode.insertBefore(row,table.nextSibling)}};exports["int"]=function(a){config=a,table=document.getElementById(config.table),tableColumn=table.getElementsByTagName("thead")[0].getElementsByTagName("tr")[0].getElementsByTagName("th").length,tbody=table.getElementsByTagName("tbody")[0],exports.run(config.pageNow)},exports.run=function(a){null==a?(exports.nowPage=1,a=null==config.pageNow?"":config.pageNow.split("=")[0]+"=1"):-1==(a+="").indexOf("=")?(exports.nowPage=a,a=config.pageNow.split("=")[0]+"="+a):exports.nowPage=config.pageNow.split("=")[1];var b=config.url;if(null!=config.pageSize&&(b+=(-1!=config.url.indexOf("?")?"&":"?")+a+"&"+config.pageSize),"post"==config.method){var c=b.split("?");httpClient.post(c[0],c[1],function(a){drawTable(a,exports.nowPage)})}else httpClient.get(b,function(a){drawTable(a,exports.nowPage)})},exports.setConfig=function(key,value){eval("config."+key+"='"+value+"'")},exports.newInstance=function(fuc){return function(){return fuc+="",-1==fuc.indexOf("\nexports=this;")&&(fuc=("0,("+fuc+")").replace("{","{\nexports=this;")),new(eval(fuc))(require,exports,module)}}(arguments.callee)});